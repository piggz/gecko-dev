From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Pavel Tumakaev <p.tumakaev@omprussia.ru>
Date: Wed, 7 Oct 2020 19:30:57 +0300
Subject: [PATCH] [sailfishos][gecko] Use registered IHistory service
 implementation in dom::Link. Fixes JB#51504

---
 dom/base/Link.cpp | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/dom/base/Link.cpp b/dom/base/Link.cpp
index 0ea844f8e49d..0785cf6cd2b2 100644
--- a/dom/base/Link.cpp
+++ b/dom/base/Link.cpp
@@ -9,7 +9,7 @@
 #include "mozilla/EventStates.h"
 #include "mozilla/MemoryReporting.h"
 #include "mozilla/dom/Element.h"
-#ifdef ANDROID
+#if defined(ANDROID) || defined(MOZ_EMBEDLITE)
 #include "mozilla/IHistory.h"
 #else
 #include "mozilla/places/History.h"
@@ -34,7 +34,7 @@
 namespace mozilla {
 namespace dom {
 
-#ifndef ANDROID
+#if !defined(ANDROID) && !defined(MOZ_EMBEDLITE)
 using places::History;
 #endif
 
@@ -363,7 +363,7 @@ EventStates Link::LinkState() const {
     // Make sure the href attribute has a valid link (bug 23209).
     // If we have a good href, register with History if available.
     if (mHistory && hrefURI) {
-#ifdef ANDROID
+#if defined(ANDROID) || defined(MOZ_EMBEDLITE)
       nsCOMPtr<IHistory> history = services::GetHistoryService();
 #else
       History *history = History::GetService();
@@ -778,7 +778,7 @@ void Link::UnregisterFromHistory() {
 
   // And tell History to stop tracking us.
   if (mHistory && mCachedURI) {
-#ifdef ANDROID
+#if defined(ANDROID) || defined(MOZ_EMBEDLITE)
     nsCOMPtr<IHistory> history = services::GetHistoryService();
 #else
     History *history = History::GetService();
-- 
2.26.2

